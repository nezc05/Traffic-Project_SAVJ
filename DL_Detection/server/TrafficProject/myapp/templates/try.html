<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>License Image Upload</title>
   
    <style>
        /* style.css */

/* Google Fonts Import */
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

body {
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(to right, #e0eafc, #cfdef3);
    color: #333;
    margin: 0;
    padding: 0;
}

h1, h2 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 20px;
    margin-top: 20px;
}

h1 {
    font-size: 28px; /* Slightly larger for emphasis */
    font-weight: 600;
}

h2 {
    font-size: 24px; /* Increase size for section titles */
    font-weight: 500;
    color: #2980b9; /* A more vibrant color for section headers */
}

.navbar {
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #2c3e50;
    padding: 20px 30px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
    position: relative;
    margin-bottom: 60px;
}

.navbar img {
    height: 50px;
    width: auto;
    border-radius: 5px;
    position: absolute;
    left: 20px;
}

.navbar h1 {
    color: white;
    font-size: 24px;
    margin: 0;
    text-align: center;
    flex-grow: 1;
    padding-left: 60px;
}

.main-content {
    display: flex;
    justify-content: center;
    align-items: center;
    height: calc(100vh - 80px);
    padding: 20px;
    background-color: #f7f9fa; /* Light background for the main content */
    border-top: 5px solid #2980b9; /* Subtle top border to separate navbar */
}

form {
    display: flex;
    flex-direction: column;
    max-width: 500px;
    justify-content: center;
    align-items: center;
    margin: 20px auto;
    padding: 20px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
    border: 1px solid #ecf0f1; /* Light border to separate from the background */
}

form label{
    display: block;
    text-align: center;
    margin-bottom: 16px;
    font-size: 18px; /* Adjust label font size for readability */
    color: #34495e; /* Dark color for better contrast */
}

form input {
    display: block;
    width: auto;
    width: 100%;
    max-width: 400px; /* Limit max width to prevent stretching on large screens */
    margin-bottom: 15px;
    padding: 6px 8px;
    /* margin-bottom: 15px; */
    font-size: 16px;

}

input[type="file"] {
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f4f4f4; /* Slightly lighter background for input */
}

button {
    background-color: #3498db;
    color: white;
    border: none;
    padding: 6px 8px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 18px;
    transition: background-color 0.3s ease;
    width: 100%;
    max-width: 400px;
}

button:hover {
    background-color: #2980b9;
}

.modal {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Black background with transparency */
    padding-top: 60px;
    overflow: auto;
    transition: all 0.3s ease;
}

.modal-content {
    background-color: #fff;
    margin: 5% auto;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 600px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
    box-sizing: border-box;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
}

.modal-content {
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    width: 80%;
    max-width: 400px;
    text-align: center;
}

.modal-header {
    font-size: 24px;
    margin-bottom: 10px;
}

.modal-body {
    margin-bottom: 20px;
}

.close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

.modal-body img {
    display: block;
    margin: 0 auto;
    max-width: 100%;
    max-height: 300px;
    object-fit: contain;
}
.card {
    background: #fff;
    margin: 10px 0;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}
.card:hover{
    box-shadow: 0 0 10px rgba(0, 0, 0, 1);
}

.card h3 {
    margin: 0 0 10px;
    color: #444;
}
.status-expired {
    color: red;
}

.expired-hint {
    color: red;
    font-weight: bold;
}


@media (max-width: 768px) {
    .modal-content {
        width: 85%;
    }

    .modal-header h2 {
        font-size: 20px;
    }

    form {
        padding: 15px;
    }
}

@media (max-width: 480px) {
    .modal-content {
        width: 90%;
    }

    .modal-header h2 {
        font-size: 18px;
    }

    form {
        padding: 10px;
    }
}


@media (max-width: 480px) {
    .navbar {
        flex-direction: column; /* Stack items vertically on very small screens */
        padding: 10px 15px;
    }

    .navbar img {
        height: 40px; /* Smaller logo size */
        position: relative;
        left: 0;
        margin-bottom: 10px; /* Add some space between the logo and text */
    }

    .navbar h1 {
        font-size: 18px; /* Further reduce font size */
        padding-left: 0; /* Remove left padding when logo is above */
    }
}


/* Media query for small devices */
@media (max-width: 768px) {
    .navbar {
        padding: 15px 20px;
        margin-bottom: 10px;
    }

    .navbar img {
        height: 40px; /* Make logo smaller on small devices */
        left: 10px; /* Adjust the left position of the logo */
    }

    .navbar h1 {
        font-size: 20px; /* Reduce font size on small devices */
        padding-left: 50px; /* Ensure the text is properly spaced from the logo */
    }
}




/* 
@media (max-width: 768px) {
    .modal-content {
        width: 85%;
    }

    .modal-header h2 {
        font-size: 20px;
    }

    form {
        padding: 15px;
    }
}

@media (max-width: 480px) {
    .modal-content {
        width: 90%;
    }

    .modal-header h2 {
        font-size: 18px;
    }

    form {
        padding: 10px;
    }

    .navbar {
        flex-direction: column;
        padding: 10px 15px;
    }

    .navbar img {
        height: 40px;
        position: relative;
        left: 0;
        margin-bottom: 10px;
    }

    .navbar h1 {
        font-size: 18px;
        padding-left: 0;
    }
} */


@media (max-width: 768px) {
    form {
        max-width: 90%; /* Make form wider on smaller screens */
        padding: 15px;
    }

    form input{
        width: 90%;
        /* width: auto; */
        /* margin-right: 10px;
        margin-left: 8px; */
        /* padding: 2px 2px; */
    }

    
    form button {
        font-size: 14px; /* Adjust font size for small devices */
        padding: 10px 10px; /* Adjust padding for better fit */
    }
}

@media (max-width: 480px) {
    form {
        padding: 10px;
    }

    form input,
    form button {
        font-size: 14px; /* Ensure smaller font size on mobile */
        padding: 8px; /* Adjust padding on mobile */
        /* margin: 4px; */
    }
}



/* Add this CSS to make the cross icon and list item more responsive */
@media (max-width: 768px) {
    /* Adjust list item padding for smaller screens */
    li {
        padding: 12px;
        font-size: 14px; /* Make text smaller on smaller devices */
    }

    /* Adjust cross icon size and position on small screens */
    li span {
        font-size: 16px; /* Smaller font size for the cross icon */
        top: 8px; /* Move the icon slightly down to avoid overlap */
        right: 8px; /* Move the icon slightly inwards */
    }
}

@media (max-width: 480px) {
    /* Further adjustments for very small screens */
    li {
        padding: 10px;
    }

    li span {
        font-size: 14px; /* Even smaller font size for the cross icon */
        top: 5px; /* Adjust position for very small screens */
        right: 5px; /* Adjust the right position */
    }
}

    </style>
</head>
<body>
    <center>
    <div class="navbar">
        <img src="https://mir-s3-cdn-cf.behance.net/projects/404/470c1f69494707.Y3JvcCwyMTI3LDE2NjQsMjAzNywxNjg.jpg" alt="Traffic System">
        <h1>DL Recognition System &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h1>
    </div>
</center>

    <h1>Upload License Image</h1>
    <form id="upload-form">
        <label for="dl_image">Choose License Image:</label>
        <input type="file" id="dl_image" name="dl_image" accept="image/*" required>
        <button type="submit">Submit</button>
    </form>
   
    <!-- Modal -->
    <div id="myModal" class="modal" role="dialog" aria-labelledby="modal-title" aria-describedby="modal-body">
        <div id="modal-content" class="modal-content">
            <div class="modal-header">
                <span class="close" aria-label="Close">&times;</span>
                <h2 id="modal-title">Person Full Details</h2>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Person details will be inserted here dynamically -->
            </div>
        </div>
    </div>

    <!-- Driver License List -->
    <h2>Recent Driver License Accessesd list</h2>
    <center>
    <div id="response-container"></div>
</center>
    <ul id="license-list" style="list-style-type: none;padding-right: 20px;">
        <!-- Recently accessed details to be put here dynamically -->
    </ul>

    <script>
        const baseURL="{{BaseSITEURL}}";
        //const baseURL = "http://127.0.0.1:8000/";
        const driverDetails = []; // Array to store details

        document.getElementById("upload-form").addEventListener("submit", async (event) => {
            event.preventDefault();

            const formData = new FormData();
            const fileInput = document.getElementById("dl_image");
            formData.append("dl_image", fileInput.files[0]);

            const responseContainer = document.getElementById("response-container");
            responseContainer.innerHTML = "<p>Loading...</p>";

            try {
                const response = await fetch(`${baseURL}/TrafficProject/api/license-details/`, {
                    method: "POST",
                    body: formData,
                });

                const data = await response.json();
                responseContainer.innerHTML = ""; // Clear the loading message

                if (response.ok) {
                    showModal(data); // Show data in a modal
                    saveDetails(data); // Save details in the list
                    fileInput.value = ''; // Reset the file input after submission
                } else {
                    showModal({ error: data.error || "Unknown error occurred" });
                }
            } catch (error) {
                responseContainer.innerHTML = "<p style='color:red;'>An error occurred while fetching details.</p>";
            }
        });

        // Function to display data in a modal
        function showModal(data) {
    try {
        const modalBody = document.getElementById('modal-body');
        const modalContent = document.getElementById('modal-content');
        const myModal = document.getElementById('myModal');

        if (!modalBody || !modalContent || !myModal) {
            throw new Error("Modal elements not found in the DOM.");
        }

        // Set default modal body color
        let ModalBodyColor = "green";

        // Determine the modal background color based on felony category
        if (data.suspicious_person_details && data.suspicious_person_details.length > 0) {
            const felonyCategory = data.suspicious_person_details[0]?.felony_catogry || "";
            if (felonyCategory === "Wanted") {
                ModalBodyColor = "red";
            } else if (felonyCategory === "Past_Felony") {
                ModalBodyColor = "orange";
            } else if (felonyCategory === "Expired_Status") {
                ModalBodyColor = "yellow";
            }
        }

        modalContent.style.backgroundColor = ModalBodyColor;

        // Helper function to check expiry
        const today = new Date();
        const checkExpiry = (date) => date && new Date(date) < today;

        // Safely extract data with fallback values
        const faceImageUrl = data.face_image_url || "default_image.png";
        const ownerDetails = data.owner_details || {};
        const dlDetails = data.dl_details || {};
        const vehicleDetails = data.vehicle_details || {};
        const suspiciousDetails = data.suspicious_person_details?.[0] || {};

        // Render modal body content
        modalBody.innerHTML = `
            <div class="card">
                <center><h3>Person Details</h3></center>
                <img src="${faceImageUrl}" alt="Face Image">
                <p><strong>Name</strong>: ${ownerDetails.name || "N/A"}</p>
                <p><strong>Address</strong>: ${ownerDetails.address || "N/A"}</p>
                <p><strong>Phone</strong>: ${ownerDetails.phone || "N/A"}</p>
                <p><strong>Date of Birth</strong>: ${ownerDetails.dob || "N/A"}</p>
            </div>
            <div class="card">
                <center><h3>Driver's License Details</h3></center>
                <p><strong>License Number</strong>: ${dlDetails.licensenumber || "N/A"}</p>
                <p><strong>Type</strong>: ${dlDetails.licensetype || "N/A"}</p>
                <p><strong>Issue Date</strong>: ${dlDetails.issuedate || "N/A"}</p>
                <p><strong>Expiry Date</strong>: ${dlDetails.expirydate || "N/A"} ${
            checkExpiry(dlDetails.expirydate) ? '<span class="expired-hint">(Expired)</span>' : ''
        }</p>
            </div>
            <div class="card">
                <center><h3>Vehicle Details</h3></center>
                <p><strong>Number Plate</strong>: ${vehicleDetails.numberplate || "N/A"}</p>
                <p><strong>Vehicle Type</strong>: ${vehicleDetails.vehicletype || "N/A"}</p>
                <p><strong>Registration Date</strong>: ${vehicleDetails.registration_date || "N/A"}</p>
                <p><strong>Registration Status</strong>: 
                    <span class="${vehicleDetails.registration_status === "Expired" ? 'status-expired' : ''}">${vehicleDetails.registration_status || "N/A"}</span>
                </p>
                <p><strong>Insurance Status</strong>: 
                    <span class="${vehicleDetails.insurance_status === "Expired" ? 'status-expired' : ''}">${vehicleDetails.insurance_status || "N/A"}</span>
                </p>
                <p><strong>PUC Status</strong>: 
                    <span class="${vehicleDetails.puc_status === "Expired" ? 'status-expired' : ''}">${vehicleDetails.puc_status || "N/A"}</span>
                </p>
            </div>
            <div class="card">
                <center><h3>Suspicious Details</h3></center>
                ${
                    suspiciousDetails.felony_catogry
                        ? `
                            <p><strong>Felony Category</strong>: ${suspiciousDetails.felony_catogry}</p>
                            <p><strong>Felony Type</strong>: ${suspiciousDetails.felony_type || "N/A"}</p>
                            <p><strong>Reason</strong>: ${suspiciousDetails.reasondetail || "N/A"}</p>
                            <p><strong>Time Happened</strong>: ${suspiciousDetails.timehappened || "N/A"}</p>
                        `
                        : "<p>No bad history</p>"
                }
            </div>
        `;

        // Display the modal
        myModal.style.display = "block";
    } catch (error) {
        console.error("Error rendering modal:", error);
        alert("An error occurred while displaying the details. Please try again.");
    }
}


        // Close the modal when the user clicks on the close button
        document.getElementsByClassName('close')[0].onclick = function () {
            document.getElementById('myModal').style.display = "none";
        };

        // Close the modal if the user clicks outside of the modal
        window.onclick = function (event) {
            if (event.target == document.getElementById('myModal')) {
                document.getElementById('myModal').style.display = "none";
            }
        };

        // Close modal with Escape key
        document.addEventListener("keydown", (event) => {
            if (event.key === "Escape") {
                document.getElementById('myModal').style.display = "none";
            }
        });

        // Function to save details and update the list
        function saveDetails(data) {
    const existingEntry = driverDetails.find(
        (entry) => entry.dl_details.licensenumber === data.dl_details.licensenumber
    );

    if (existingEntry) return;

    driverDetails.push(data);

    // Determine the color based on felony category or suspicious_person_details
    let listItemColor = "green"; // Default color for no suspicious details
    if (data.suspicious_person_details && data.suspicious_person_details.length > 0) {
        const felonyCategory = data.suspicious_person_details[0].felony_catogry;
        if (felonyCategory === "Wanted") {
            listItemColor = "red";
        } else if (felonyCategory === "Past_Felony") {
            listItemColor = "orange";
        } else if (felonyCategory === "Expired_Status") {
            listItemColor = "yellow";
        }
    }

    const licenseList = document.getElementById("license-list");
    const listItem = document.createElement("li");

    // Set the background color and other styles
    listItem.style.backgroundColor = listItemColor;
    listItem.style.padding = "10px";
    listItem.style.paddingRight = "20px";
    listItem.style.marginBottom = "5px";
    listItem.style.borderRadius = "5px";
    listItem.style.position = "relative"; // Ensure the list item is positioned to contain the cross
    listItem.style.display = "flex"; // Use Flexbox for layout
    listItem.style.flexDirection = "column"; // Stack name and license number vertically
    listItem.style.alignItems = "flex-start"; // Align the text to the left

    // Create content for name and license number
    const nameText = document.createElement("div");
nameText.innerHTML = `<strong>Name:</strong> ${data.owner_details.name}`;  // Use innerHTML to insert HTML
nameText.style.marginBottom = "5px";  // Add some space between name and license number

const licenseText = document.createElement("div");
licenseText.innerHTML = `<strong>License:</strong> ${data.dl_details.licensenumber}`;  // Use innerHTML to insert HTML

    // Add the name and license text to the list item
    listItem.appendChild(nameText);
    listItem.appendChild(licenseText);

    // Add a cross icon to remove from the list
    const crossIcon = document.createElement("span");
    crossIcon.innerHTML = "&times;";
    crossIcon.style.cursor = "pointer";
    crossIcon.style.fontSize = "20px";
    crossIcon.style.color = "black";
    crossIcon.style.position = "absolute";
    crossIcon.style.top = "10px";
    crossIcon.style.right = "10px";
   // crossIcon.style.zIndex = "1"; // Make sure it's above the text

    // Add click event to cross icon to remove the item
    crossIcon.addEventListener("click", (event) => {
        event.stopPropagation(); // Prevent the click event from propagating to the list item
        driverDetails.splice(driverDetails.indexOf(data), 1);
        licenseList.removeChild(listItem);
    });

    // Add the cross icon to the list item
    listItem.appendChild(crossIcon);

    // Add an event listener to show modal on clicking the list item
    listItem.addEventListener("click", () => {
        showModal(data);
    });

    // Add the list item to the license list
    licenseList.appendChild(listItem);
}

    </script>
</body>
</html>
